# 安装与依赖配置

<cite>
**Referenced Files in This Document**   
- [pyproject.toml](file://pyproject.toml)
- [README.md](file://README.md)
- [src/main.py](file://src/main.py)
</cite>

## 目录

1. [项目元信息与Python版本要求](#项目元信息与python版本要求)
2. [依赖安装方法](#依赖安装方法)
   - [使用uv sync安装](#使用uv-sync安装)
   - [使用pip install安装](#使用pip-install安装)
3. [输出目录创建](#输出目录创建)
4. [虚拟环境配置建议](#虚拟环境配置建议)
5. [常见安装问题排查](#常见安装问题排查)
6. [总结](#总结)

## 项目元信息与Python版本要求

本项目通过 `pyproject.toml` 文件定义了核心元信息和依赖关系。根据文件内容，项目名称为 "hello-scan-code"，当前版本为 "0.1.0"，描述为“高效代码搜索工具”。

最关键的技术要求是 Python 版本必须 **>=3.10**。这是由 `requires-python = ">=3.10"` 这一配置项明确指定的。在进行任何安装操作之前，请确保您的系统已安装符合此要求的 Python 版本。

您可以通过以下命令检查当前 Python 版本：
```bash
python --version
```
或
```bash
python3 --version
```

如果版本过低，需要先升级 Python 至 3.10 或更高版本。

**Section sources**
- [pyproject.toml](file://pyproject.toml#L1-L9)

## 依赖安装方法

### 使用uv sync安装

`uv` 是一个现代化的 Python 包管理器，以其极快的依赖解析速度而闻名。推荐使用 `uv` 来安装本项目的依赖。

安装步骤如下：

1.  确保已安装 `uv` 工具。如果未安装，可以使用 pip 全局安装：
    ```bash
    pip install uv
    ```
2.  在项目根目录下执行同步命令：
    ```bash
    uv sync
    ```
    此命令会读取 `pyproject.toml` 文件中的依赖列表，并自动安装所有必需的包及其兼容版本。

**Section sources**
- [README.md](file://README.md#L78-L81)

### 使用pip install安装

如果您更习惯使用传统的 `pip` 工具，也可以直接安装所需的依赖包。

安装命令如下：
```bash
pip install loguru pandas openpyxl
```

这些包的具体作用如下：
- **loguru**: 提供强大且易于使用的日志记录功能，用于生成详细的运行日志。
- **pandas**: 一个强大的数据处理和分析库，用于将搜索结果组织成结构化数据并导出到 Excel。
- **openpyxl**: 一个用于读写 Excel 2010 xlsx/xlsm/xltx/xltm 文件的库，是 `pandas` 导出 Excel 功能的底层支持。

**Section sources**
- [pyproject.toml](file://pyproject.toml#L6-L9)
- [README.md](file://README.md#L83-L85)

## 输出目录创建

为了确保程序能够正常运行并保存其输出结果，必须在项目根目录下创建三个特定的输出目录：`db`、`report` 和 `logs`。

您可以使用以下命令一次性创建这些目录：
```bash
mkdir -p db report logs
```

*   **db/**: 该目录用于存放 SQLite 数据库文件（默认为 `results.db`），存储所有搜索结果。
*   **report/**: 该目录用于存放导出的 Excel 报告文件（默认为 `results.xlsx`）。
*   **logs/**: 该目录用于存放由 `loguru` 生成的日志文件，便于追踪程序运行状态和排查问题。

如果这些目录不存在，程序在尝试写入文件时可能会抛出 `FileNotFoundError` 或权限错误。

**Section sources**
- [README.md](file://README.md#L87-L89)

## 虚拟环境配置建议

强烈建议使用 Python 虚拟环境来隔离项目的依赖，以避免与其他项目的包发生冲突。

以下是使用 `venv` 创建和激活虚拟环境的步骤：

1.  **创建虚拟环境**:
    ```bash
    python -m venv venv
    ```
    这将在项目根目录下创建一个名为 `venv` 的文件夹，其中包含独立的 Python 解释器和包安装目录。

2.  **激活虚拟环境**:
    *   **Windows (Command Prompt)**:
        ```cmd
        venv\Scripts\activate
        ```
    *   **Windows (PowerShell)**:
        ```powershell
        venv\Scripts\Activate.ps1
        ```
    *   **macOS / Linux**:
        ```bash
        source venv/bin/activate
        ```

3.  **在虚拟环境中安装依赖**:
    激活虚拟环境后，再执行 `uv sync` 或 `pip install` 命令。所有依赖都将被安装到 `venv` 文件夹中，不会影响系统的全局 Python 环境。

4.  **退出虚拟环境**:
    完成工作后，可以使用以下命令退出：
    ```bash
    deactivate
    ```

## 常见安装问题排查

### 权限错误

在某些系统上，尤其是在全局安装包时，可能会遇到权限不足的错误（如 `PermissionError`）。解决方案是：
*   使用虚拟环境，避免修改系统级的 Python 包。
*   如果必须全局安装，可以在命令前加上 `sudo`（仅限 macOS/Linux），但这不推荐。

### 依赖冲突

当多个项目共享同一个 Python 环境时，不同项目可能需要同一包的不同版本，从而导致冲突。**解决方法就是使用虚拟环境**，为每个项目创建独立的依赖空间。

### 平台兼容性问题（Windows下的grep）

本项目在设计上优先使用系统自带的 `grep` 命令以获得最佳性能。然而，在 Windows 系统上，`grep` 命令并非原生可用。

**解决方案**:
1.  **安装 Git for Windows**: 这是最简单的方案。Git for Windows 不仅提供了 Git 命令行工具，还包含了 GNU Core Utilities，其中包括 `grep`。安装后，`grep` 将被添加到系统 PATH 中。
2.  **使用 WSL (Windows Subsystem for Linux)**: 在 WSL 中运行该项目，可以获得完整的 Linux 环境和所有 Unix 工具。
3.  **依赖降级**: 即使没有 `grep`，程序也能正常工作。它会自动检测到 `grep` 不可用，并优雅地降级到使用纯 Python 实现的搜索逻辑。虽然速度会慢一些，但功能完全不受影响。

**Section sources**
- [README.md](file://README.md#L10-L13)

## 总结

成功配置本项目的关键在于：首先确认 Python 版本满足 >=3.10 的要求；其次，通过 `uv sync` 或 `pip install` 安装 `loguru`、`pandas` 和 `openpyxl` 等核心依赖；然后，务必创建 `db`、`report` 和 `logs` 三个输出目录；最后，强烈推荐使用虚拟环境来管理依赖，以保证环境的纯净和可复现性。对于 Windows 用户，安装 Git for Windows 可以解决 `grep` 命令的兼容性问题。